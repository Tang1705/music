<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tang's Music</title>
    <link rel="icon" href="../bit_favicon.ico">
    <link rel="stylesheet" type="text/css" href="../resources/css/style-ipad.css">
    <link rel="stylesheet" type="text/css" href="../resources/css/avater-ipad.css">
    <script type="text/javascript" src="https://unpkg.com/wavesurfer.js"></script>
    <script type="text/javascript" src="https://repo.bfw.wiki/bfwrepo/js/jquery-3.2.1.min.js"></script>

</head>
<body>
<div id="right-top"></div>
<div id="left-top"></div>
<div id="left-bottom"></div>
<div id="right-bottom"></div>

<div><a href="https://tang5618.com"><img src="../resources/img/qt.png"
                                         style="position: absolute;right:5%;top:5%;width: 5%" alt="qt"></a></div>

<div class="tang"></div>
<div class="circle" style="position: absolute;bottom: 8%;right: 13.5%;"></div>
<div><img src="../resources/img/tang-ps.gif" style="position: absolute;right:13%;bottom:8%;width: 8%;border-radius:25%;" alt=""></div>
<div style="position: absolute;right:15.5%;bottom:1.5%;font-weight: bolder"><p style="line-height: 15px;color: black">Tang</p></div>

<div class="yolk"></div>
<div class="circle" style="position: absolute;bottom: 7%;right: 4.5%;"></div>
<div><img src="../resources/img/yolk-ps.gif" style="position: absolute;right:4.4%;bottom:7.5%;width: 8%;border-radius:25%;"></div>
<div style="position: absolute;right:6.5%;bottom:1.5%;font-weight: bolder"><p style="line-height: 15px;color: black">Yolk</p></div>

<div class="music-player-container is-pausing">
    <img src="../resources/assets/icon.svg"
         style="position: absolute;width: 2.5rem;z-index: 55;margin-top: 2rem;margin-left: 3rem">
    <div style="position: absolute; z-index: 55;font-weight: bolder;font-size: 22px;margin-top: 0.9rem;margin-left: 26.5rem">
        <p style="color: #515044">东边有山西边有河</p>
    </div>
    <div id="top"></div>
    <div id="bottom"></div>
    <div id="circle"></div>
    <div id="disk"></div>
    <div id="manner"></div>
    <div id="corner"></div>
    <div id="corner-right"></div>
    <div id="high"></div>
    <div id="low"></div>


    <div class="progress-bar">
        <div class="music">
            <div class="info">
                <div class="controls">
                    <img src="../resources/assets/play.svg" id="playBtn" alt="">
                    <img src="../resources/assets/stop.svg" id="stopBtn" alt="">
                    <img src="../resources/assets/volume.svg" id="volumeBtn" alt="">
                </div>
                <div id="waveform"></div>
            </div>
        </div>
    </div>

    <div class="lyric" style="float:left;position:absolute;width:auto;margin-left:0;z-index: 60">
        <ul id="lrclist" style="transform: translateY(0px);width:375px"></ul>
    </div>

    <div id="current-time"></div>

    <div class="music-player">
        <div class="player-content-container">

        </div>
    </div>

    <div class="album">
        <div class="vinyl"></div>
    </div>


</div>

<script>
    var playBtn = document.getElementById('playBtn');
    var stopBtn = document.getElementById('stopBtn');
    var volumeBtn = document.getElementById('volumeBtn');

    var wavesurfer = WaveSurfer.create({
        container: '#waveform',
        // waveColor: 'aqua',
        progressColor: '#4D59F5',
        barWidth: 3,
        height: 50,
        responsive: true,
        hideScrollbar: true,
        cursorColor: '#fff',
        barRadius: 5,
    });
    wavesurfer.load('../resources/music/music.flac');

    playBtn.onclick = function () {
        wavesurfer.playPause();
        if (playBtn.src.includes("play.svg")) {
            playBtn.src = "../resources/assets/pause.svg";
            $('.music-player-container').toggleClass('is-playing');
            $('.music-player-container').toggleClass('is-pausing');
        } else {
            playBtn.src = "../resources/assets/play.svg";
            $('.music-player-container').toggleClass('is-pausing');
            $('.music-player-container').toggleClass('is-playing');
        }
    }

    stopBtn.onclick = function () {
        wavesurfer.stop();
        if (!playBtn.src.includes("play.svg")){
            $('.music-player-container').toggleClass('is-pausing');
            $('.music-player-container').toggleClass('is-playing');
            playBtn.src = "./resources/assets/play.svg";
        }
    }

    volumeBtn.onclick = function () {
        wavesurfer.toggleMute();
        if (volumeBtn.src.includes("volume.svg")) {
            volumeBtn.src = "../resources/assets/mute.svg";
        } else {
            volumeBtn.src = "../resources/assets/volume.svg";
        }
    }

    wavesurfer.on('finish', function () {
        playBtn.src = "../resources/assets/play.svg";
        wavesurfer.stop();
        $('.music-player-container').toggleClass('is-pausing');
        $('.music-player-container').toggleClass('is-playing');
    });


    var lrcJSON = {
        "[00:00.00]":"东边有山西边有河",
        "[00:00.90]":"词：HEAT J",
        "[00:01.95]":"曲：HEAT J/陈锦杰",
        "[00:03.90]":"编曲：HEAT J/xuuyuee/陈锦杰",
        "[00:05.85]":"制作人：HEAT J/陈锦杰",
        "[00:07.80]":"录音师：HEAT J",
        "[00:09.75]":"混音师：HEAT J",
        "[00:11.70]":"母带：HEAT J",
        "[00:13.65]":"录音棚：RC Studio",
        "[00:15.60]":"吉他：陈锦杰",
        "[00:17.55]":"鼓：HEAT J",
        "[00:19.51]":"贝斯：郑天澍",
        "[00:21.46]":"钢琴：陈锦杰",
        "[00:23.41]":"和声编写：HEAT J",
        "[00:25.36]":"和声：陈锦杰/HEAT J",
        "[00:27.31]":"项目统筹/监制：佳琳@腾讯音乐人",
        "[00:29.26]":"出品：【你好大学声】校园厂牌",
        "[00:31.21]":"OP/SP：腾讯音乐人",
        "[00:33.18]":"爷爷时间过得飞快",
        "[00:34.86]":"很高兴孙子一直都没有变坏",
        "[00:37.26]":"不知道我给你转的钱",
        "[00:39.03]":"你有没有给自己买一些燕麦",
        "[00:41.37]":"上次回家到你离开只有半个月",
        "[00:43.35]":"没照顾过你枉费你的心血",
        "[00:45.48]":"是我不孝一直在追梦",
        "[00:47.43]":"直到你离开我才坠入那个黑洞",
        "[00:49.71]":"我依旧会跟我的爸妈拌嘴",
        "[00:51.39]":"但你放心孙子再坏都不会去犯罪",
        "[00:53.94]":"或许应该让我跟你来换位",
        "[00:55.77]":"实在不太忍心看着你一直在受罪",
        "[00:58.11]":"如果缺什么就托梦告诉我",
        "[00:59.91]":"如果你想我了也可以来找我捉弄我",
        "[01:02.19]":"我曾经很怕鬼现在我不怕",
        "[01:04.11]":"好想再见你或许是我太傻",
        "[01:06.21]":"不知道东边还有没有山",
        "[01:08.28]":"不知道西边还有没有河",
        "[01:10.38]":"我还记得你给我唱的歌",
        "[01:12.24]":"我把珍贵的记忆都放进相册",
        "[01:14.55]":"每次我们过来吃饭你会加菜",
        "[01:16.41]":"安排一大桌子吃不完的饭都变坏",
        "[01:18.48]":"我想给你写一封信就现在",
        "[01:20.58]":"有点后悔高中不务正业谈的恋爱",
        "[01:22.68]":"对不起孙子做得不够完美",
        "[01:24.75]":"没在你最痛苦的时候让孙子来陪",
        "[01:26.85]":"知道你强忍着痛在深夜以后",
        "[01:28.92]":"不知道弟弟什么时候才能听懂",
        "[01:30.96]":"希望天堂没有病痛不会病重",
        "[01:33.30]":"孙子为了减肥一定会多运动",
        "[01:35.19]":"爷爷我会多给奶奶发微信",
        "[01:37.41]":"就这么一点事根本不费劲yeah",
        "[01:42.15]":"东边有山西边有河",
        "[01:46.29]":"我想在梦里告诉你",
        "[01:50.49]":"我看见你",
        "[01:52.59]":"还在等着我对你说我爱你",
        "[01:58.32]":"天都黑了你在哪里呢",
        "[02:02.25]":"我好想拥抱你像小时候",
        "[02:07.17]":"我还在哼你唱的歌",
        "[02:12.66]":"只是你听不到了",
        "[02:15.48]":"有点遗憾没带你看过我的演出",
        "[02:17.64]":"虽然我的演出不太适合你",
        "[02:19.77]":"现在我只能把所有的遗憾",
        "[02:21.36]":"写成一张专辑放进我的纸盒里",
        "[02:23.94]":"不知道你看没看到我们流泪",
        "[02:25.80]":"姐姐伤心的变得更加憔悴",
        "[02:27.84]":"你的房间还留着你的气味",
        "[02:29.70]":"只可惜再见面没有机会",
        "[02:31.95]":"希望我走起来那天你会看见",
        "[02:34.08]":"保佑我的兄弟全部不会叛变",
        "[02:36.18]":"我们带着你的精神继续繁衍",
        "[02:38.01]":"虽然辛苦但我们在继续攀岩",
        "[02:40.32]":"不用担心我会照顾家人",
        "[02:42.21]":"二十年过去我早变成大人",
        "[02:44.46]":"希望你能远离世间的嚣闹",
        "[02:46.38]":"我会努力读书成为你的骄傲",
        "[02:48.93]":"我只想再拥抱你",
        "[02:52.95]":"（就像mv 里拍的那样我们爷俩一起开心下象棋yeah）",
        "[02:57.27]":"好像隔了几万里",
        "[03:01.29]":"（看着你的照片触碰不到唯一能够碰到的是冰冷的身体）",
        "[03:05.64]":"好想再多看看你",
        "[03:10.86]":"（爷爷whats up 这里是HEAT J 首次自我介绍）",
        "[03:13.92]":"你是天上哪颗星",
        "[03:18.18]":"（爷爷whats up 这里是孙子再次自我介绍）",
        "[03:22.32]":"东边有山西边有河",
        "[03:26.49]":"我想在梦里告诉你",
        "[03:30.66]":"我看见你",
        "[03:32.76]":"还在等着我对你说我爱你",
        "[03:38.49]":"天都黑了你在哪里呢",
        "[03:42.45]":"我好想拥抱你像小时候",
        "[03:47.37]":"我还在哼你唱的歌",
        "[03:52.83]":"只是你听不到了",
        "[04:01.26]":"只是你听不到了",
        "[04:09.60]":"只是你听不到了",
    };


    var lrcTime = [];//歌词对应的时间数组
    var ul = $("#lrclist")[0];//获取ul

    var i = 0;
    $.each(lrcJSON, function (key, value) {//遍历lrc
        lrcTime[i++] = parseFloat(key.substr(1, 3)) * 60 + parseFloat(key.substring(4, 10));//00:00.000转化为00.000格式
        ul.innerHTML += "<li><p>" + lrcJSON[key] + "</p></li>";//ul里填充歌词
    });
    lrcTime[lrcTime.length] = lrcTime[lrcTime.length - 1] + 3;//如不另加一个结束时间，到最后歌词滚动不到最后一句


    var $li = $("#lrclist>li");//获取所有li
    var isLocked = false;
    var currentLine = 0;//当前播放到哪一句了
    var currentTime;//当前播放的时间
    var ppxx;//保存ul的translateY值
    // var current = document.getElementById("current-time")

    wavesurfer.on("audioprocess", () => {
        // wavesurfer.ontimeupdate = function () {
        if (isLocked === false) {
            isLocked = true;
            currentTime = wavesurfer.getCurrentTime();
            for (n = -8, len = lrcTime.length; n <= 8; n++) {//将可视部分的所有其他歌词设置为默认
                if (currentLine + n < len - 1) {
                    $li.get(currentLine + n).className = "";

                } else break;
            }

            for (j = 0, len = lrcTime.length; j < len; j++) {

                if (currentTime <= lrcTime[j + 1] && currentTime >= lrcTime[j]) {
                    currentLine = j;
                    ppxx = 100 - (currentLine * 62);
                    ul.style.transform = "translateY(" + ppxx + "px)";

                    $li.get(currentLine - 1).className = "";
                    $li.get(currentLine).className = "on";
                    break;
                }
            }

            // current.innerHTML = "<p style='color: white'>" + currentTime.toFixed(2) + "</p>"
            isLocked = false;
        }

    });

</script>

<script type="text/javascript">
    window.onload = function () {
        window.requestAnimationFrame(getDate)
    }

    function getDate() {
        window.setTimeout(function () {
            window.requestAnimationFrame(getDate)
        }, 1000 / 2)
        var d = new Date();
        var year = d.getFullYear()  //获取年
        var month = d.getMonth() + 1;  //获取月，从 Date 对象返回月份 (0 ~ 11)，故在此处+1
        var days = d.getDate() //获取日期
        if (month < 10) month = "0" + month
        if (days < 10) days = "0" + days

        var months = new Array("Jan.", "Feb.", "Mar.", "Apr.", "May", "Jun", "Jul", "Aug", "Sept.", "Oct.", "Nov.", "Dec.")
        var Tools = document.getElementById("corner-right")
        var da = months[month - 1] + " " + days + " " + year
        // var da = year + " 年 " + month + " 月 " + days + " 日 "
        Tools.innerHTML = "<p style='color: black;font-size: 6.3pt;position: absolute;margin-top: 2rem;font-weight: bolder;'>" + da + "</p>"
    }
</script>

</body>
</html>