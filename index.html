<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tang's Music</title>
    <link rel="icon" href="./bit_favicon.ico">
    <link rel="stylesheet" type="text/css" href="./resources/css/style.css">
    <link rel="stylesheet" type="text/css" href="./resources/css/avater.css">
<!--    <link rel="stylesheet" type="text/css" href="https://open.lujiawei.com/web/msgsk/1/messages.css">-->
    <script type="text/javascript" src="https://unpkg.com/wavesurfer.js"></script>
    <script type="text/javascript" src="https://repo.bfw.wiki/bfwrepo/js/jquery-3.2.1.min.js"></script>
</head>
<body>
<div id="right-top"></div>
<div id="left-top"></div>
<div id="left-bottom"></div>
<div id="right-bottom"></div>

<div><a href="https://tang5618.com"><img src="resources/img/qt.png"
                                         style="position: absolute;right:5%;top:5%;width: 5%" alt="qt"></a></div>

<div class="tang"></div>
<div class="circle" style="position: absolute;bottom: 8%;right: 11.8%;"></div>
<iframe src="./tang.html" frameborder=0
        style="position: absolute;right: 11.6%;bottom: 5%;z-index: 99;height: 200rem"></iframe>
<!--<div><img src="resources/img/tang-ps.gif" style="position: absolute;right:12%;bottom:8%;width: 5%;border-radius:25%;"-->
<!--          alt="">-->
<!--</div>-->
<div style="position: absolute;right:13.3%;bottom:1.8%;font-weight: bolder"><p style="color: black">Tang</p></div>

<div class="yolk"></div>
<div class="circle" style="position: absolute;bottom: 7%;right: 4.8%;"></div>
<iframe src="./yolk.html" frameborder=0
        style="position: absolute;right: 4%;bottom: 5%;z-index: 99;height: 200rem"></iframe>
<!--<div><img src="resources/img/yolk-ps.gif" style="position: absolute;right:5%;bottom:7.5%;width: 5%;border-radius:25%;" alt="">-->
<!--</div>-->
<div style="position: absolute;right:6.5%;bottom:1.8%;font-weight: bolder"><p style="color: black">Yolk</p></div>

<div class="music-player-container is-pausing">
    <!--    <img src="./resources/assets/vip.svg"-->
    <!--         style="position: absolute;width: 2.5rem;z-index: 55;margin-top: 2.5rem;margin-left: 3rem">-->
    <!--    <div style="position: absolute; z-index: 55;font-weight: bolder;font-size: 24px;margin-top: 1.7rem;right:35%">-->
    <!--        <p style="color: #515044">青春未散场</p>-->
    <!--    </div>-->

<!--    <div class="scene"><img src="./resources/video/scene.mp4" alt=""></div>-->
    <div class="scene"><img src="https://5618.oss-cn-beijing.aliyuncs.com/VIP/scene.mp4" alt=""></div>
    <div class="mask"></div>

    <div id="top"></div>
    <div id="bottom"></div>
    <div id="circle"></div>
    <div id="disk"></div>
    <div id="manner"></div>
    <div id="corner"></div>
    <div id="corner-right"></div>
    <div id="high"></div>
    <div id="low"></div>


    <div class="progress-bar">
        <div class="music">
            <div class="info">
                <div class="controls">
                    <img src="./resources/assets/play.svg" id="playBtn" alt="">
                    <img src="./resources/assets/stop.svg" id="stopBtn" alt="">
                    <img src="./resources/assets/volume.svg" id="volumeBtn" alt="">
                </div>
                <div id="waveform"></div>
            </div>
        </div>
    </div>

    <div class="lyric" style="float:left;position:absolute;width:auto;margin-left:0;z-index: 60">
        <div id="timestamp" class="timestamp" style="z-index: 20;font-weight: bolder;position: absolute;left: 50%;top:10%"></div>
        <ul id="lrclist" style="transform: translateY(0px);width:500px"></ul>
    </div>

    <div id="current-time"></div>

    <div class="music-player">
        <div class="player-content-container">

        </div>
    </div>

    <div class="album">
        <div class="vinyl"></div>
    </div>


</div>

<script>
    var playBtn = document.getElementById('playBtn');
    var stopBtn = document.getElementById('stopBtn');
    var volumeBtn = document.getElementById('volumeBtn');

    var timestamp = document.getElementById("timestamp")

    var wavesurfer = WaveSurfer.create({
        container: '#waveform',
        // waveColor: 'aqua',
        progressColor: '#4D59F5',
        barWidth: 3,
        height: 50,
        responsive: true,
        hideScrollbar: true,
        cursorColor: '#fff',
        barRadius: 5,
    });
    wavesurfer.load('./resources/music/music.flac');

    playBtn.onclick = function () {
        timestamp.innerHTML = "<p style=\"color: white;\">上午 9:41</p>"
        wavesurfer.playPause();
        if (playBtn.src.includes("play.svg")) {
            playBtn.src = "./resources/assets/pause.svg";
            $('.music-player-container').toggleClass('is-playing');
            $('.music-player-container').toggleClass('is-pausing');
        } else {
            playBtn.src = "./resources/assets/play.svg";
            $('.music-player-container').toggleClass('is-pausing');
            $('.music-player-container').toggleClass('is-playing');
        }
    }

    stopBtn.onclick = function () {
        wavesurfer.stop();
        if (!playBtn.src.includes("play.svg")) {
            $('.music-player-container').toggleClass('is-pausing');
            $('.music-player-container').toggleClass('is-playing');
            playBtn.src = "./resources/assets/play.svg";
        }
    }

    volumeBtn.onclick = function () {
        wavesurfer.toggleMute();
        if (volumeBtn.src.includes("volume.svg")) {
            volumeBtn.src = "./resources/assets/mute.svg";
        } else {
            volumeBtn.src = "./resources/assets/volume.svg";
        }
    }

    wavesurfer.on('finish', function () {
        playBtn.src = "./resources/assets/play.svg";
        wavesurfer.stop();
        $('.music-player-container').toggleClass('is-pausing');
        $('.music-player-container').toggleClass('is-playing');
    });


    var lrcJSON = {
        "[00:00.00]": "月满",
        "[00:01.27]": "演唱：猪老三儿/吴遥清",
        "[00:03.41]": "词：王韵澄",
        "[00:06.82]": "曲：王韵澄",
        "[00:10.23]": "编曲：王韵澄",
        "[00:13.64]": "混音：王韵澄",
        "[00:17.06]": "制作：王韵澄",
        "[00:20.47]": "统筹：张志峰",
        "[00:23.88]": "城市沉陷之间",
        "[00:26.18]": "繁花若隐若现",
        "[00:29.33]": "滞留在以前 是落叶的秋天",
        "[00:35.20]": "日与夜的交接",
        "[00:37.98]": "相视间竟躲偏",
        "[00:40.84]": "想起多年前",
        "[00:42.94]": "而无知的翻越",
        "[00:45.70]": "尝过了人生的不停不转",
        "[00:47.46]": "表情不咸不淡",
        "[00:48.60]": "穿过了尘世的白眼",
        "[00:49.91]": "褒贬落下亦正亦反",
        "[00:51.39]": "撑破了穿梭昼夜再不需要光的依赖",
        "[00:54.10]": "却在每天的复制粘贴里",
        "[00:55.88]": "对你抑制喜欢",
        "[00:57.15]": "就想着 一阵的",
        "[00:58.40]": "一时的 一致的 一直的",
        "[01:00.59]": "你像降落城市的一只白鹤",
        "[01:02.99]": "已无生机周围忽然响起一切声音",
        "[01:05.90]": "仙人抚我顶 结发受长生",
        "[01:07.79]": "你眼底的这片云",
        "[01:09.84]": "让我波澜初初起",
        "[01:12.59]": "风里我的上半句",
        "[01:15.45]": "都随落叶翻去",
        "[01:18.44]": "盛满会始乱终弃",
        "[01:21.15]": "缺角曾烙下过最沉的印记",
        "[01:25.79]": "心乱都趁秋夜翻过去",
        "[01:30.05]": "直到有人谈分离",
        "[01:32.64]": "淌过波澜重重迷",
        "[01:35.48]": "情深是极昼燃尽",
        "[01:38.32]": "烧毁我的身形",
        "[01:41.51]": "弥雾衔开了远近",
        "[01:44.03]": "斑驳至极成熟的人不幸运",
        "[01:48.55]": "满月随后便倾泻支离",
        "[02:07.01]": "纸混着落叶 搅成了一圈",
        "[02:12.55]": "知晓这一切 成为你之间",
        "[02:18.08]": "灯烧断了丝线 夜眼红了云月",
        "[02:23.72]": "思绪抽离间 竟为你而冷却",
        "[02:31.91]": "谁记得 呼吸间",
        "[02:32.85]": "城市里面沉默一片",
        "[02:34.22]": "却变得 翻过几⻚",
        "[02:35.40]": "固守己念 而后目空一切",
        "[02:37.14]": "期待你叫醒我并收起我的一成不变",
        "[02:39.98]": "穿梭人群烟火的街竟然溢出了满月",
        "[02:42.72]": "却想着 一阵的",
        "[02:44.00]": "一时的 一致的 一直的",
        "[02:46.49]": "你像降落心底的一只白鹤",
        "[02:48.85]": "布满荆棘的手慢慢写起一封⻓信",
        "[02:51.42]": "天上白玉京 鼓楼十二重",
        "[02:53.12]": "你眼底的这片云",
        "[02:55.53]": "让我波澜初初起",
        "[02:58.32]": "风里我的上半句",
        "[03:01.13]": "都随落叶翻去",
        "[03:04.09]": "盛满会始乱终弃",
        "[03:06.84]": "缺角曾烙下过最沉的印记",
        "[03:11.49]": "心乱都趁秋夜翻过去",
        "[03:15.57]": "直到有人谈分离",
        "[03:18.29]": "淌过波澜重重迷",
        "[03:21.19]": "情深是极昼燃尽",
        "[03:24.02]": "烧毁我的身形",
        "[03:27.06]": "弥雾衔开了远近",
        "[03:29.72]": "斑驳至极成熟的人不幸运",
        "[03:34.25]": "满月随后便倾泻支离",
    };


    var lrcTime = [];//歌词对应的时间数组
    var ul = $("#lrclist")[0];//获取ul

    var i = 0;
    $.each(lrcJSON, function (key, value) {//遍历lrc
        lrcTime[i++] = parseFloat(key.substr(1, 3)) * 60 + parseFloat(key.substring(4, 10));//00:00.000转化为00.000格式
        ul.innerHTML += "<li><p>" + lrcJSON[key] + "</p></li>";//ul里填充歌词
    });
    lrcTime[lrcTime.length] = lrcTime[lrcTime.length - 1] + 3;//如不另加一个结束时间，到最后歌词滚动不到最后一句


    var $li = $("#lrclist>li");//获取所有li
    var isLocked = false;
    var currentLine = 0;//当前播放到哪一句了
    var currentTime;//当前播放的时间
    var ppxx;//保存ul的translateY值
    // var current = document.getElementById("current-time")

    wavesurfer.on("audioprocess", () => {

        // wavesurfer.ontimeupdate = function () {
        if (isLocked === false) {
            isLocked = true;
            currentTime = wavesurfer.getCurrentTime();
            for (n = -8, len = lrcTime.length; n <= 8; n++) {//将可视部分的所有其他歌词设置为默认
                if (currentLine + n < len - 1) {
                    $li.get(currentLine + n).className = "";

                } else break;
            }

            for (j = 0, len = lrcTime.length; j < len; j++) {

                if (currentTime <= lrcTime[j + 1] && currentTime >= lrcTime[j]) {
                    currentLine = j;
                    ppxx = 120 - (currentLine * 62);
                    ul.style.transform = "translateY(" + ppxx + "px)";

                    // $li.get(currentLine - 1).className = "";

                    if (currentLine % 2 === 0){
                        $li.get(currentLine-1).className = "on greymsg-last";
                        $li.get(currentLine).className = "on bluemsg-last";
                    }
                    else{
                        $li.get(currentLine-1).className = "on bluemsg-last";
                        $li.get(currentLine).className = "on greymsg-last";
                    }


                    break;
                }
            }

            // current.innerHTML = "<p style='color: white'>" + currentTime.toFixed(2) + "</p>"
            isLocked = false;
        }

    });

</script>

<script type="text/javascript">
    window.onload = function () {
        window.requestAnimationFrame(getDate)
    }

    function getDate() {
        window.setTimeout(function () {
            window.requestAnimationFrame(getDate)
        }, 1000 / 2)
        var d = new Date();
        var year = d.getFullYear()  //获取年
        var month = d.getMonth() + 1;  //获取月，从 Date 对象返回月份 (0 ~ 11)，故在此处+1
        var days = d.getDate() //获取日期
        if (month < 10) month = "0" + month
        if (days < 10) days = "0" + days

        var months = new Array("Jan.", "Feb.", "Mar.", "Apr.", "May", "Jun", "Jul", "Aug", "Sept.", "Oct.", "Nov.", "Dec.")
        var Tools = document.getElementById("corner-right")
        var da = months[month - 1] + " " + days + " " + year
        // var da = year + " 年 " + month + " 月 " + days + " 日 "
        Tools.innerHTML = "<p style='color: black;font-size: 8.5pt;position: absolute;margin-top: 2rem;margin-left:0.3rem;font-weight: bolder;'>" + da + "</p>"
    }
</script>

</body>
</html>