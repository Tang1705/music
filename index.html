<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tang's Music</title>
    <link rel="stylesheet" type="text/css" href="./resources/css/style.css">
    <link rel="stylesheet" type="text/css" href="./resources/css/avater.css">
    <script type="text/javascript" src="https://unpkg.com/wavesurfer.js"></script>
    <script type="text/javascript" src="https://repo.bfw.wiki/bfwrepo/js/jquery-3.2.1.min.js"></script>

</head>
<body>
<div id="right-top"></div>
<div id="left-top"></div>
<div id="left-bottom"></div>
<div id="right-bottom"></div>

<div><a href="https://tang5618.com"><img src="resources/img/qt.png"
                                         style="position: absolute;right:5%;top:5%;width: 5%" alt="qt"></a></div>

<div class="tang"></div>
<div class="circle" style="position: absolute;bottom: 8%;right: 11.8%;"></div>
<div><img src="resources/img/tang-ps.gif" style="position: absolute;right:12%;bottom:8%;width: 5%;border-radius:25%;"
          alt="">
</div>
<div style="position: absolute;right:13.3%;bottom:1.8%;font-weight: bolder"><p style="color: black">Tang</p></div>

<div class="yolk"></div>
<div class="circle" style="position: absolute;bottom: 7%;right: 4.8%;"></div>
<div><img src="resources/img/yolk-ps.gif" style="position: absolute;right:5%;bottom:7.5%;width: 5%;border-radius:25%;" alt="">
</div>
<div style="position: absolute;right:6.5%;bottom:1.8%;font-weight: bolder"><p style="color: black">Yolk</p></div>

<div class="music-player-container is-pausing">
    <img src="./resources/assets/icon.svg"
         style="position: absolute;width: 2.5rem;z-index: 55;margin-top: 2rem;margin-left: 3rem">
    <div style="position: absolute; z-index: 55;font-weight: bolder;font-size: 24px;margin-top: 1.7rem;margin-left: 43rem">
        <p style="color: #515044">光亮</p>
    </div>
    <div id="top"></div>
    <div id="bottom"></div>
    <div id="circle"></div>
    <div id="disk"></div>
    <div id="manner"></div>
    <div id="corner"></div>
    <div id="corner-right"></div>
    <div id="high"></div>
    <div id="low"></div>


    <div class="progress-bar">
        <div class="music">
            <div class="info">
                <div class="controls">
                    <img src="./resources/assets/play.svg" id="playBtn" alt="">
                    <img src="./resources/assets/stop.svg" id="stopBtn" alt="">
                    <img src="./resources/assets/volume.svg" id="volumeBtn" alt="">
                </div>
                <div id="waveform"></div>
            </div>
        </div>
    </div>

    <div class="lyric" style="float:left;position:absolute;width:auto;margin-left:0;z-index: 60">
        <ul id="lrclist" style="transform: translateY(0px);width:500px"></ul>
    </div>

    <div id="current-time"></div>

    <div class="music-player">
        <div class="player-content-container">

        </div>
    </div>

    <div class="album">
        <div class="vinyl"></div>
    </div>


</div>

<script>
    var playBtn = document.getElementById('playBtn');
    var stopBtn = document.getElementById('stopBtn');
    var volumeBtn = document.getElementById('volumeBtn');

    var wavesurfer = WaveSurfer.create({
        container: '#waveform',
        // waveColor: 'aqua',
        progressColor: '#4D59F5',
        barWidth: 3,
        height: 50,
        responsive: true,
        hideScrollbar: true,
        // barRadius: 5,
    });
    wavesurfer.load('./resources/music/music.flac');

    playBtn.onclick = function () {
        wavesurfer.playPause();
        if (playBtn.src.includes("play.svg")) {
            playBtn.src = "./resources/assets/pause.svg";
            $('.music-player-container').toggleClass('is-playing');
            $('.music-player-container').toggleClass('is-pausing');
        } else {
            playBtn.src = "./resources/assets/play.svg";
            $('.music-player-container').toggleClass('is-pausing');
            $('.music-player-container').toggleClass('is-playing');
        }
    }

    stopBtn.onclick = function () {
        wavesurfer.stop();
        playBtn.src = "./resources/assets/play.svg";
        $('.music-player-container').toggleClass('is-pausing');
        $('.music-player-container').toggleClass('is-playing');
    }

    volumeBtn.onclick = function () {
        wavesurfer.toggleMute();
        if (volumeBtn.src.includes("volume.svg")) {
            volumeBtn.src = "./resources/assets/mute.svg";
        } else {
            volumeBtn.src = "./resources/assets/volume.svg";
        }
    }

    wavesurfer.on('finish', function () {
        playBtn.src = "./resources/assets/play.svg";
        wavesurfer.stop();
        $('.music-player-container').toggleClass('is-pausing');
        $('.music-player-container').toggleClass('is-playing');
    });


    var lrcJSON = {
        "[00:00.00]":"光亮 大型纪录片《紫禁城》主题歌 - 周深",
        "[00:00.52]":"词：苏轼（北宋）/苟璘",
        "[00:00.60]":"曲：钱雷",
        "[00:00.69]":"编曲：钱雷",
        "[00:00.81]":"制作人：钱雷",
        "[00:00.95]":"吉他：高飞",
        "[00:01.07]":"弦乐编写：胡静成",
        "[00:01.27]":"弦乐监棚：胡静成",
        "[00:01.47]":"弦乐团：国际首席爱乐乐团",
        "[00:01.79]":"配唱/录音：徐威@52Hz Studio（Shanghai）",
        "[00:02.08]":"伴唱：周深/钱雷",
        "[00:02.29]":"戏腔指导：董炳义",
        "[00:02.49]":"混音/母带：赵靖BIG.J@SBMS Beijing",
        "[00:02.75]":"特别鸣谢：周深工作室",
        "[00:03.01]":"主题歌音乐专辑工作团队：",
        "[00:03.33]":"总顾问：汪金福",
        "[00:03.50]":"出品人：钱实穆",
        "[00:03.68]":"总监制：刘健/徐毅",
        "[00:03.91]":"监制：钱彤/贾奋勇/胡译友/吴志勇",
        "[00:04.37]":"新华社“声在中国”工作室：",
        "[00:04.66]":"工作室负责人：魏骅/饶丹",
        "[00:04.98]":"协作：朴文琳/刘兆伟/康薇/郑思琳",
        "[00:05.45]":"项目策划：朴林西思文化传媒",
        "[00:05.80]":"总策划：张洋",
        "[00:05.94]":"音乐总监：苟璘",
        "[00:06.11]":"制作统筹：高溪丰",
        "[00:06.32]":"音乐版权顾问：刘靖",
        "[00:06.55]":"翻译：卢佳",
        "[00:06.67]":"创意顾问：袁嘉骏",
        "[00:06.87]":"平面摄影师：温璐",
        "[00:07.07]":"海报设计团队：本真工作室/李贞（海报设计总监）段冰洋/王世婷/林恩",
        "[00:07.94]":"平面设计：包凡彬",
        "[00:08.14]":"宣传物料及黑胶设计：周禹喆",
        "[00:08.49]":"音乐发行：太合麦田",
        "[00:08.72]":"项目总统筹：闫曼嘉",
        "[00:08.96]":"项目/艺人统筹：李艺佳/李靖",
        "[00:09.33]":"项目/艺人协力：张靓琳/肖晰美（实习）",
        "[00:09.80]":"制作总监：蔡庭贵",
        "[00:10.00]":"策略行销：武鹏",
        "[00:10.17]":"视觉统筹：赵宏韬",
        "[00:10.38]":"平面设计：张雯/夏马尾",
        "[00:10.67]":"媒介：小美/肖琄/陈梦麟/张鹏远/罗茜/太阳/高仪/梁倩玉/赵天一/勘琦/成梓琪/陈婷",
        "[00:11.89]":"运营：耿长春/曹瑞/张齐宪/谢思聪/王子龙/洪子斌/赵媛媛",
        "[00:12.70]":"宣传营销：北京很有可能文化传播有限公司/金朝顺/沈雨娟/张倩玉/夏童/田贝贝/汪斯遥/丁敏",
        "[00:13.97]":"资产管理：杨柳",
        "[00:14.15]":"出品：北京广播电视台/故宫博物院/太合音乐集团",
        "[00:14.79]":"监制：新华社\"声在中国\"",
        "[00:15.10]":"联合出品：朴林西思文化传媒/微博",
        "[00:15.54]":"协办单位：北京国际音乐产业大会",
        "[00:15.95]":"技术支持：新华社媒体融合生产技术与系统国家重点实验室/杜比实验室",
        "[00:16.84]":"宣发合作伙伴：新浪娱乐/微博音乐/新浪音乐",
        "[00:17.42]":"独家短视频平台：抖音",
        "[00:17.89]":"海上 一阵风吹起",
        "[00:24.83]":"白云涌向陆地",
        "[00:29.18]":"季风带走沙粒",
        "[00:35.17]":"四季 冷暖的交替",
        "[00:41.90]":"多鲜活的生命",
        "[00:46.35]":"又枯萎的痕迹",
        "[00:51.54]":"是奔跑中突然袭来的风雨",
        "[00:59.77]":"是黑暗中一根火柴燃烧的光明",
        "[01:08.61]":"也许你猜不透未知的宿命",
        "[01:16.92]":"像流星飞翔着它却不知目的",
        "[01:25.86]":"可是啊 我却 却愿意相信",
        "[01:34.35]":"最渺小最微弱最柔软最无畏的你",
        "[01:43.02]":"用尽了全力 努力地回应",
        "[01:51.39]":"再无边再无尽再无解总有一线生机",
        "[01:59.48]":"光亮你自己",
        "[02:04.27]":"戏曲念白：",
        "[02:18.65]":"莫听穿林打叶声",
        "[02:23.10]":"一蓑烟雨任平生",
        "[02:28.18]":"畅音阁里终一叙",
        "[02:33.20]":"六百年一粟 沧海一梦",
        "[02:43.07]":"可是啊 我却 却愿意去相信",
        "[02:51.46]":"最渺小最微弱最柔软最无畏的你",
        "[03:00.02]":"用尽了全力 努力地去回应",
        "[03:08.52]":"再无边再无尽再无解总有一线生机",
        "[03:16.56]":"光亮你自己",
        "[03:23.08]":"戏曲唱腔：",
        "[03:26.72]":"莫听穿林打叶声",
        "[03:35.01]":"一蓑烟雨任平生",
        "[03:43.59]":"畅音阁里终一叙",
        "[03:51.71]":"六百年一粟 沧海一梦",
        "[04:03.68]":"无论目的 最无畏的你",
        "[04:20.77]":"不问宿命 最无畏的你",
    };


    var lrcTime = [];//歌词对应的时间数组
    var ul = $("#lrclist")[0];//获取ul

    var i = 0;
    $.each(lrcJSON, function (key, value) {//遍历lrc
        lrcTime[i++] = parseFloat(key.substr(1, 3)) * 60 + parseFloat(key.substring(4, 10));//00:00.000转化为00.000格式
        ul.innerHTML += "<li><p>" + lrcJSON[key] + "</p></li>";//ul里填充歌词
    });
    lrcTime[lrcTime.length] = lrcTime[lrcTime.length - 1] + 3;//如不另加一个结束时间，到最后歌词滚动不到最后一句


    var $li = $("#lrclist>li");//获取所有li
    var isLocked = false;
    var currentLine = 0;//当前播放到哪一句了
    var currentTime;//当前播放的时间
    var ppxx;//保存ul的translateY值
    // var current = document.getElementById("current-time")

    wavesurfer.on("audioprocess", () => {
        // wavesurfer.ontimeupdate = function () {
        if (isLocked === false) {
            isLocked = true;
            currentTime = wavesurfer.getCurrentTime();
            for (n = -8, len = lrcTime.length; n <= 8; n++) {//将可视部分的所有其他歌词设置为默认
                if (currentLine + n < len - 1) {
                    $li.get(currentLine + n).className = "";

                } else break;
            }

            for (j = 0, len = lrcTime.length; j < len; j++) {

                if (currentTime <= lrcTime[j + 1] && currentTime >= lrcTime[j]) {
                    currentLine = j;
                    ppxx = 160 - (currentLine * 62);
                    ul.style.transform = "translateY(" + ppxx + "px)";

                    $li.get(currentLine - 1).className = "";
                    $li.get(currentLine).className = "on";
                    break;
                }
            }

            // current.innerHTML = "<p style='color: white'>" + currentTime.toFixed(2) + "</p>"
            isLocked = false;
        }

    });

</script>

<script type="text/javascript">
    window.onload = function () {
        window.requestAnimationFrame(getDate)
    }

    function getDate() {
        window.setTimeout(function () {
            window.requestAnimationFrame(getDate)
        }, 1000 / 2)
        var d = new Date();
        var year = d.getFullYear()  //获取年
        var month = d.getMonth() + 1;  //获取月，从 Date 对象返回月份 (0 ~ 11)，故在此处+1
        var days = d.getDate() //获取日期
        if (month < 10) month = "0" + month
        if (days < 10) days = "0" + days

        var months = new Array("Jan.", "Feb.", "Mar.", "Apr.", "May", "Jun", "Jul", "Aug", "Sept.", "Oct.", "Nov.", "Dec.")
        var Tools = document.getElementById("corner-right")
        var da = months[month - 1] + " " + days + " " + year
        // var da = year + " 年 " + month + " 月 " + days + " 日 "
        Tools.innerHTML = "<p style='color: black;font-size: 8.5pt;position: absolute;margin-top: 2rem;margin-left:0.3rem;font-weight: bolder;'>" + da + "</p>"
    }
</script>

</body>
</html>